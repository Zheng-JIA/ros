<?xvl version="1.0"?>
<launch>
  <arg name="joy_dev" default="/dev/input/js0"/>
  <arg name="frame" default="base_link" />
  <arg name="worldFrame" default="/world" />
  <arg name="2ndQuad" default="0" type="bool" />
  <include file="$(find crazyflie_driver)/launch/crazyflie_server.launch" />
  
  <node name="joy" pkg="joy" type="joy_node" output="screen">
      <param name="dev" value="$(arg joy_dev)" />
  </node>

  <node name="add_point" pkg="beginner_tutorials" type="add_point.py" output="screen">
  </node>
  <group ns="crazyflie0">
    <node pkg="crazyflie_driver" type="crazyflie_add" name="crazyflie_add" output="screen">
      <param name="uri" value="radio://0/80/2M/E7E7E7E7E3" />
      <param name="tf_prefix" value="crazyflie0" />
      <rosparam>
          genericLogTopics: ["state"]
          genericLogTopicFrequencies: [10]
          genericLogTopic_state_Variables: ["kalman.stateX", "kalman.stateY", "kalman.stateZ", "stabilizer.roll", "stabilizer.pitch", "stabilizer.yaw"]
      </rosparam>
    </node>
    <!--
    <node name="viconTorviz" pkg="beginner_tutorials" type="add_point.py" output="screen">
    </node>
    --> 
    <!--
    <node name="toggleLed" pkg="beginner_tutorials" type="toggleLed.py" output="screen">
    </node>
    -->
    <node name="crazyflie_state" pkg="beginner_tutorials" type="crazyflie_state_broadcaster.py" output="screen">
        <param name="frame" value="base_link"/>
        <param name="worldFrame" value="/world"/>
    </node>

    <!--<node name="vicon_to_extPos" pkg="beginner_tutorials" type="vicon_to_extPos.py" output="screen">
    </node>-->
    <node name="basic_controller" pkg="beginner_tutorials" type="basic_controller.py" output="screen">
        <param name="frame" value="crazyflie0/$(arg worldFrame)"/>
        <param name="worldFrame" value="$(arg worldFrame)" />
        <param name="joy_topic" value="/joy" />
        <param name="phase" value="1.57" />
    </node>
  </group>

  <group ns="crazyflie1" if="$(arg 2ndQuad)">
    <node pkg="crazyflie_driver" type="crazyflie_add" name="crazyflie_add" output="screen">
      <param name="uri" value="radio://0/80/2M/E7E7E7E7E1" />
      <param name="tf_prefix" value="crazyflie1" />
      <rosparam>
          genericLogTopics: ["state"]
          genericLogTopicFrequencies: [10]
          genericLogTopic_state_Variables: ["kalman.stateX", "kalman.stateY", "kalman.stateZ", "stabilizer.roll", "stabilizer.pitch", "stabilizer.yaw"]
      </rosparam>  
    </node>
    <node name="crazyflie_state" pkg="beginner_tutorials" type="crazyflie_state_broadcaster.py" output="screen">
        <param name="frame" value="base_link"/>
        <param name="worldFrame" value="/world"/>
    </node>

    <node name="basic_controller" pkg="beginner_tutorials" type="basic_controller.py" output="screen">
        <param name="frame" value="crazyflie1/$(arg worldFrame)"/>
        <param name="worldFrame" value="$(arg worldFrame)" />
        <param name="joy_topic" value="/joy" />
        <param name="phase" value="1.57" />
    </node>
  </group>
  <!-- run rviz -->
  <param name="robot_description" command="$(find xacro)/xacro.py $(find crazyflie_description)/urdf/crazyflie2.urdf.xacro" />
  <node name="rviz" pkg="rviz" type="rviz" args="-d $(find crazyflie_demo)/launch/crazyflie_pos.rviz" required="true" />
 
</launch>

